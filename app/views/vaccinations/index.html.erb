<% page_title = "Record vaccinations" %>

<%= render(AppFlashMessageComponent.new(flash:)) %>

<% content_for :before_main do %>
  <%= render AppBreadcrumbComponent.new(items: [
    { text: 'Home', href: dashboard_path },
    { text: 'School sessions', href: sessions_path },
    { text: @session.name, href: session_path(@session) },
    { text: page_title }
  ]) %>
<% end %>

<%= h1 page_title, page_title:, class: "govuk-heading-l" %>

<%=
render AppTabComponent.new(title: "Vaccinations", classes: 'nhsuk-tabs') do |c|
  c.with_tab(id: "action-needed", label: t("states.action_needed.label") + " (#{ @partitioned_patient_sessions[:action_needed].size })", classes: 'nhsuk-tabs__panel') do
    render "patients_with_actions",
           id: "action-needed",
           caption: t("states.action_needed.title"),
           patient_sessions: @partitioned_patient_sessions[:action_needed]
  end
  c.with_tab(id: "vaccinated", label: t("states.vaccinated.label") + " (#{ @partitioned_patient_sessions[:vaccinated].size })", classes: 'nhsuk-tabs__panel') do
    render "patients_with_outcomes",
           id: "vaccinated",
           caption: t("states.vaccinated.title"),
           patient_sessions: @partitioned_patient_sessions[:vaccinated]
  end
  c.with_tab(id: "could-not-vaccinate", label: t("states.not_vaccinated.label") + " (#{ @partitioned_patient_sessions[:not_vaccinated].size })", classes: 'nhsuk-tabs__panel') do
    render "patients_with_outcomes",
           id: "could-not-vaccinate",
           caption: t("states.not_vaccinated.title"),
           patient_sessions: @partitioned_patient_sessions[:not_vaccinated]
  end
end
%>
