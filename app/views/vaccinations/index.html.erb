<% page_title = "Record vaccinations" %>

<% content_for :before_main do %>
  <%= render AppBreadcrumbComponent.new(items: [
    { text: 'Home', href: dashboard_path },
    { text: 'School sessions', href: sessions_path },
    { text: "#{@session.campaign.name} session at #{@session.name}", href: session_path(@session) },
    { text: page_title }
  ]) %>
<% end %>

<%= h1 page_title, page_title: %>

<% def tab_content(slot, state, tab_path, page_type:, columns: %i[name dob])
  label = t("states.#{state}.label")
  selected = state == @current_tab
  path = vaccinations_tab_session_path(@session, tab: tab_path)
  count = @tab_counts[state]

  slot.with_tab(
    id: label.parameterize,
    link: path,
    label: "#{label} (#{count})",
    classes: 'nhsuk-tabs__panel',
    selected:
  ) do
    if selected && @patient_sessions.size > 0
      if page_type == :actions
        render "patients_with_actions",
               id: label.parameterize,
               caption: t("states.#{state}.title"),
               patient_sessions: @patient_sessions
     else
       render "patients_with_outcomes",
              id: label.parameterize,
              caption: t("states.#{state}.title"),
              patient_sessions: @patient_sessions
     end
   else
     ""
   end
 end
end %>


<%= render AppTabComponent.new title: "Vaccinations", classes: 'nhsuk-tabs' do |slot|
  tab_content(slot, :action_needed, :actions, page_type: :actions)
  tab_content(slot, :vaccinated, :vaccinated, page_type: :outcomes)
  tab_content(slot, :vaccinate_later, :later, page_type: :outcomes)
  tab_content(slot, :could_not_vaccinate, :"could-not", page_type: :outcomes)
end %>
