<%= render(AppFlashMessageComponent.new(flash: flash)) %>

<% page_title = "Session details" %>

<% content_for :before_main do %>
  <%= render AppBreadcrumbComponent.new(items: [
    { text: 'Home', href: dashboard_path },
    { text: 'School sessions', href: sessions_path },
    { text: @session.name, href: session_path(@session) },
    { text: page_title, active: true }
  ]) %>
<% end %>

<%= h1 page_title %>

<%= render AppCardComponent.new(heading: "Session") do %>
  <%= govuk_summary_list classes: 'app-summary-list--no-bottom-border' do |summary_list|
    summary_list.with_row do |row|
      row.with_key { "School" }
      row.with_value { @session.location.name }
    end

    summary_list.with_row do |row|
      row.with_key { "Vaccine" }
      row.with_value { @session.campaign.name }
    end

    summary_list.with_row do |row|
      row.with_key { "Date" }
      row.with_value { @session.date.to_fs(:nhsuk_date_day_of_week) }
    end

    summary_list.with_row do |row|
      row.with_key { "Time" }
      row.with_value { @session.human_enum_name(:time_of_day) }
    end

    summary_list.with_row do |row|
      row.with_key { "Cohort" }
      row.with_value do

        patients_count = @session.patients.count
        pluralize(patients_count, "children")
      end
    end

    summary_list.with_row do |row|
      row.with_key { "Consent requests" }
      row.with_value {
        "Send #{pluralize(@session.days_between_consent_and_session, "day")} before the session"
      }
    end

    summary_list.with_row do |row|
      row.with_key { "Reminders" }
      row.with_value {
        "Send #{pluralize(@session.days_between_consent_and_reminder, "day")} after the first consent request"
      }
    end

    summary_list.with_row do |row|
      row.with_key { "Deadline for responses" }
      row.with_value {
        @session.date == @session.close_consent_at ?
        "Allow responses until the day of the session" :
        "Allow responses until #{@session.close_consent_at.to_fs(:nhsuk_date)}"
      }
    end
  end %>
<% end %>
