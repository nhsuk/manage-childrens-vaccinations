<%= render(AppFlashMessageComponent.new(flash: flash)) %>

<% page_title = "Triage health questions" %>

<% content_for :before_main do %>
  <%= render AppBreadcrumbComponent.new(items: [
    { text: 'Home', href: dashboard_path },
    { text: 'School sessions', href: sessions_path },
    { text: @session.name, href: session_path(@session) },
    { text: page_title }
  ]) %>
<% end %>

<%= h1 page_title, page_title: %>

<% def consent_tab(slot, state, columns: %i[name dob])
  label = t("states.#{state}.label")
  data = @tabs[state]
  slot.with_tab(id: label.parameterize,
                label: "#{label} (#{data.size})",
                classes: 'nhsuk-tabs__panel') do
    if data.size > 0
      render AppPatientTableComponent.new(
        patient_sessions: data,
        tab_id: label.parameterize,
        caption: t("states.#{state}.title"),
        columns:,
        route: :triage,
      )
    else
      render AppEmptyListComponent.new
    end
  end
end %>

<%= render AppTabComponent.new title: "Consents", classes: 'nhsuk-tabs' do |slot|
  consent_tab(slot, :needs_triage)
  consent_tab(slot, :triage_complete)
  consent_tab(slot, :no_triage_needed)
end %>
