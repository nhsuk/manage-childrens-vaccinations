<%= render(AppFlashMessageComponent.new(flash: flash)) %>

<% page_title = "Check consent responses" %>

<% content_for :before_main do %>
  <%= render AppBreadcrumbComponent.new(items: [
    { text: 'Home', href: dashboard_path },
    { text: 'School sessions', href: sessions_path },
    { text: @session.name, href: session_path(@session) },
    { text: page_title },
  ]) %>
<% end %>

<%= h1 page_title, page_title:, class: "govuk-heading-l" %>

<% def consent_tab(slot, label, data, columns: %i[name dob])
  slot.with_tab(label: "#{label} (#{data.size})",
                classes: 'nhsuk-tabs__panel') do
    if data.size > 0
      render AppPatientTableComponent.new(
        patient_sessions: data,
        columns:,
        route: :consent,
      )
    else
      render AppEmptyListComponent.new(
        message: "We couldnâ€™t find any children that matched your filters."
      )
    end
  end
end %>

<%= govuk_tabs title: "Consents", classes: 'nhsuk-tabs' do |slot|
  consent_tab(slot, "Consent given", @tabs[:consent_given?])
  consent_tab(slot, "Consent refused", @tabs[:consent_refused?],
              columns: %i[name dob reason])
  consent_tab(slot, "Consent conflicts", @tabs[:consent_conflicts?])
  consent_tab(slot, "No response", @tabs[:no_consent?])
end %>
