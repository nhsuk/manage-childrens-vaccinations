<% if @caption.present? %>
  <h2 class="nhsuk-heading-s nhsuk-u-margin-0 app-visually-hidden-from-tablet">
    <%= @caption %>
  </h2>
<% end %>

<action-table id="<%= @tab_id %>" class="nhsuk-grid-row" sort="name" store>
  <div class="nhsuk-grid-column-one-quarter">
    <%= render AppPatientTableFilterComponent.new(tab_id: @tab_id, filter_actions:) %>
  </div>
  <div class="nhsuk-grid-column-three-quarters">
    <%= govuk_table(classes: "app-table--patients") do |table| %>
      <%= table.with_head do |head| %>
        <%= head.with_row do |row| %>
          <%= @columns.each do |column| %>
            <%= row.with_cell(
              text: column_name(column),
              html_attributes: { "data-col": column }
            ) %>
          <% end %>
        <% end %>
      <% end %>

      <%= table.with_body do |body| %>
        <%= @patient_sessions.each do |patient_session| %>
          <%= body.with_row do |row| %>
            <%= @columns.each do |column| %>
              <%= row.with_cell(**column_value(patient_session, column)) %>
            <% end %>
          <% end %>
        <% end %>
      <% end %>
    <% end %>
    <action-table-no-results>
      <%= render AppEmptyListComponent.new(
        text: t("table.no_filtered_results")
      ) %>
    </action-table-no-results>
  </div>
</action-table>
