<%= render AppConsentStatusComponent.new(patient_session:) %>

<% if patient_session.consents.present? %>
  <% consents_grouped_by_parent.each do |summary, consents| %>
    <%= render AppDetailsComponent.new(summary:, open: open_consents?) do %>
      <%= render AppConsentDetailsComponent.new(consents:) %>

      <% if consents.any?(&:response_refused?) %>
        <p><%= contact_parent_or_guardian_link(consents) %></p>
      <% end %>
    <% end %>
  <% end %>

  <%= if display_health_questions?
    render AppDetailsComponent.new(
      summary: "Responses to health questions",
      open: open_health_questions?,
      expander: true
    ) do
      render AppHealthQuestionsComponent.new(consents: @patient_session.consents)
    end
  end %>
<% else %>
  <p class="app-status">
    No response yet
  </p>

  <p>
    <%=
    govuk_button_link_to(
      "Get consent",
      new_session_patient_nurse_consents_path(session, patient, @route),
      class: "nhsuk-u-margin-bottom-2"
    )
    %>

    <% if display_gillick_consent_button? %>
      <%=
      govuk_button_link_to(
        "Assess Gillick competence",
        assessing_gillick_session_patient_nurse_consents_path(
          session,
          patient,
          route: @route
        ),
        class: "nhsuk-button--secondary nhsuk-u-margin-bottom-2"
      )
      %>
    <% end %>
  </p>
<% end %>
