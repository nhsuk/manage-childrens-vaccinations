@startuml
title Successful offline POST with CSRF

autoactivate on

group Prepare to work offline
    Browser -> record.nhs.uk: GET /patients/1/vaccinations/new
    return 200 OK
    note right
        // HTML form without CSRF token
    end note
end

== Browser goes offline ==

group Perform offline work
    Browser-->Browser: Records vaccination
end

== Browser comes back online ==

Browser -> record.nhs.uk: GET /csrf
return 200 OK
note right: "New CSRF token"

group Update patient data
    Browser -> record.nhs.uk: POST /patients/1/vaccinations/
    note right
        vaccination=mmr
        vaccination_performed=false
        csrf="New CSRF token"
    end note
    return 200 OK
end
@enduml
